// b5078b20-aea3-4c37-a18f-b370c03f02a6 Service - Configuration
// 7be8ac4b-7eb4-4e09-b134-91a46b622832 Service - Display
// 4553d138-1d00-4b6f-bc42-955a89cf8c36 Service - Fan
// 260a0845-e62f-48c6-aef9-04f62ff8bffd Service - Fan Control Policy
// f62918ab-33b7-4f47-9fba-8ce9de9fecbb Service - NeoPixel
// de44dd71-2400-4cd1-a3f3-9fb00c4697d7 Service - Photocatalytic
// 8959bb3e-3063-4a46-9b9a-69fdbc327f1c Service - Servos

// 216aa791-97d0-46ac-8752-60bbc00611e1 VOC Indexed
// c3acb286-8071-427b-bbed-d64987373f23 VOC Sensor Raw
// 75134bec-dd06-49b1-bac2-c15e05fd7199 Service Data Aggregation
// 79cd747f-91af-49a6-95b2-5b597c683129 Fan Power & Tachometer Aggregation
// 45d2e7d7-40c4-46a6-a160-43eb02d01e27 Fan Thermal Limit Settings
// 03f61fe0-9fe7-4516-98e6-056de551687f Tachometer
// 3886216a-d971-4c71-afc4-19f8fba8fb92 WS2812 Config
// 5d91b6ce-7db1-4e06-b8cb-d75e7dd49aae WS2812 Update Span
// 86a25d55-1893-4d01-8ea8-8970f622c243 Display - UI
// 9c327c7f-188f-4345-950f-bd586f13f324 Servo  - Start/End PWM % struct
// f48a18bb-e03c-4583-8006-5b54422e2045 Config - Reboot
// d4b66bf4-3d8f-4746-b6a2-8a59d2eac3ce Config - Flags
// a84b00c0-7102-4cc6-a4ea-a65050502d3f Config - Checkpoint Sensor Calibration
// 75bf055c-02be-466f-8c7d-6ebc72078048 Config - Reset Sensor Calibration
// f2810b13-8cd7-4d6f-bb1b-e276db7fadbf Config - Reset Settings
// ee786ac0-7700-47dd-b7de-9958f96303f2 Config - VOC Calibration Enabled
// 2e9410cb-30fd-4b2c-8c95-934226a9ba29 Config - Pin Assignments
// 5b1dc210-6a51-4cf9-bda7-085604199856 Config - Pin Assignments Default
// 0f6d7c4b-c30c-45b2-b32a-0e5b130429f0 Config - Pin Assignments Validation Message

// #define ORG_BLUETOOTH_CHARACTERISTIC_NON_METHANE_VOLATILE_ORGANIC_COMPOUNDS_CONCENTRATION 0x2BD3
// uint16, PPB w/ resolution of 1, sadly we can't really use it since SGP40 gives us an arbitrary index in 0 to 500
// #define ORG_BLUETOOTH_CHARACTERISTIC_VOC_CONCENTRATION 0x2BE7
// #define ORG_BLUETOOTH_CHARACTERISTIC_PERCENTAGE_8 2B04
// #define ORG_BLUETOOTH_CHARACTERISTIC_COUNT_16 2AEA
// #define Percentage16_10 0543a134-244f-405b-9d43-0351a5336ef7

PRIMARY_SERVICE, GAP_SERVICE
CHARACTERISTIC, GAP_DEVICE_NAME, READ, "Nevermore Controller"
// 0x0542 air-quality sensor appearance, but in LE order
CHARACTERISTIC, GAP_APPEARANCE, READ, 42 05

PRIMARY_SERVICE, GATT_SERVICE
CHARACTERISTIC, GATT_DATABASE_HASH, READ,

PRIMARY_SERVICE, ORG_BLUETOOTH_SERVICE_DEVICE_INFORMATION
CHARACTERISTIC, ORG_BLUETOOTH_CHARACTERISTIC_HARDWARE_REVISION_STRING, READ, "@NEVERMORE_BOARD@"
// HACK: prefix with `commit: ` to force `compile_gatt.py` to interpret it as a string
CHARACTERISTIC, ORG_BLUETOOTH_CHARACTERISTIC_SOFTWARE_REVISION_STRING, READ, "commit: @GIT_DESCRIPTION@"
CHARACTERISTIC, ORG_BLUETOOTH_CHARACTERISTIC_SERIAL_NUMBER_STRING, READ | DYNAMIC

/////////////////////////////
// Environmental Sensing Service
/////////////////////////////

PRIMARY_SERVICE, ORG_BLUETOOTH_SERVICE_ENVIRONMENTAL_SENSING
////////////////////////////////////////
// tempature: intake, exhaust, mcu
CHARACTERISTIC, ORG_BLUETOOTH_CHARACTERISTIC_TEMPERATURE, READ | DYNAMIC
CHARACTERISTIC_USER_DESCRIPTION, READ | DYNAMIC
ENVIRONMENTAL_SENSING_MEASUREMENT, READ | DYNAMIC
CHARACTERISTIC, ORG_BLUETOOTH_CHARACTERISTIC_TEMPERATURE, READ | DYNAMIC
CHARACTERISTIC_USER_DESCRIPTION, READ | DYNAMIC
ENVIRONMENTAL_SENSING_MEASUREMENT, READ | DYNAMIC
CHARACTERISTIC, ORG_BLUETOOTH_CHARACTERISTIC_TEMPERATURE, READ | DYNAMIC
CHARACTERISTIC_USER_DESCRIPTION, READ | DYNAMIC
ENVIRONMENTAL_SENSING_MEASUREMENT, READ | DYNAMIC
////////////////////////////////////////
// humidity: intake, exhaust
CHARACTERISTIC, ORG_BLUETOOTH_CHARACTERISTIC_HUMIDITY, READ | DYNAMIC
CHARACTERISTIC_USER_DESCRIPTION, READ | DYNAMIC
ENVIRONMENTAL_SENSING_MEASUREMENT, READ | DYNAMIC
CHARACTERISTIC, ORG_BLUETOOTH_CHARACTERISTIC_HUMIDITY, READ | DYNAMIC
CHARACTERISTIC_USER_DESCRIPTION, READ | DYNAMIC
ENVIRONMENTAL_SENSING_MEASUREMENT, READ | DYNAMIC
////////////////////////////////////////
// pressure: intake, exhaust
CHARACTERISTIC, ORG_BLUETOOTH_CHARACTERISTIC_PRESSURE, READ | DYNAMIC
CHARACTERISTIC_USER_DESCRIPTION, READ | DYNAMIC
ENVIRONMENTAL_SENSING_MEASUREMENT, READ | DYNAMIC
CHARACTERISTIC, ORG_BLUETOOTH_CHARACTERISTIC_PRESSURE, READ | DYNAMIC
CHARACTERISTIC_USER_DESCRIPTION, READ | DYNAMIC
ENVIRONMENTAL_SENSING_MEASUREMENT, READ | DYNAMIC
////////////////////////////////////////
// after all 16-bit characteristics, since we're a 128 bit UUID
// (BT sec says to group characteristics by ID size. e.g. 16s, 32s, 128s...)
// SGP40 VOC index: intake, exhaust
CHARACTERISTIC, 216aa791-97d0-46ac-8752-60bbc00611e1, READ | DYNAMIC
CHARACTERISTIC_USER_DESCRIPTION, READ | DYNAMIC
ENVIRONMENTAL_SENSING_MEASUREMENT, READ | DYNAMIC
// , , 0x06 uint16, 0 exponent, 0x2700 unitless, 0x1 BT SIG namespace, 0 unknown desc
CHARACTERISTIC_FORMAT, sgp40-voc-index, 06, 0, 2700, 1, 0000
VALID_RANGE, READ | DYNAMIC
CHARACTERISTIC, 216aa791-97d0-46ac-8752-60bbc00611e1, READ | DYNAMIC
CHARACTERISTIC_USER_DESCRIPTION, READ | DYNAMIC
ENVIRONMENTAL_SENSING_MEASUREMENT, READ | DYNAMIC
CHARACTERISTIC_FORMAT, sgp40-voc-index, 06, 0, 2700, 1, 0000
VALID_RANGE, READ | DYNAMIC
// VOC sensor raw: intake, exhaust
CHARACTERISTIC, c3acb286-8071-427b-bbed-d64987373f23, READ | DYNAMIC
CHARACTERISTIC_USER_DESCRIPTION, READ | DYNAMIC
ENVIRONMENTAL_SENSING_MEASUREMENT, READ | DYNAMIC
// , , 0x06 uint16, 0 exponent, 0x2700 unitless, 0x1 BT SIG namespace, 0 unknown desc
CHARACTERISTIC_FORMAT, sgp40-voc-raw, 06, 0, 2700, 1, 0000
CHARACTERISTIC, c3acb286-8071-427b-bbed-d64987373f23, READ | DYNAMIC
CHARACTERISTIC_USER_DESCRIPTION, READ | DYNAMIC
ENVIRONMENTAL_SENSING_MEASUREMENT, READ | DYNAMIC
CHARACTERISTIC_FORMAT, sgp40-voc-raw, 06, 0, 2700, 1, 0000
// env data aggregation
CHARACTERISTIC, 75134bec-dd06-49b1-bac2-c15e05fd7199, READ | NOTIFY | DYNAMIC
CHARACTERISTIC_USER_DESCRIPTION, READ | DYNAMIC

/////////////////////////
// Fan Control Service
/////////////////////////

PRIMARY_SERVICE, 4553d138-1d00-4b6f-bc42-955a89cf8c36
// Fan PWM
CHARACTERISTIC, 2B04, READ | DYNAMIC
CHARACTERISTIC_USER_DESCRIPTION, READ | DYNAMIC
// Fan PWM - Override (not-known -> automatic control)
CHARACTERISTIC, 2B04, READ | WRITE | DYNAMIC
CHARACTERISTIC_USER_DESCRIPTION, READ | DYNAMIC
// Fan PWM - Passive
CHARACTERISTIC, 2B04, READ | WRITE | DYNAMIC
CHARACTERISTIC_USER_DESCRIPTION, READ | DYNAMIC
// Fan PWM - Automatic
CHARACTERISTIC, 2B04, READ | WRITE | DYNAMIC
CHARACTERISTIC_USER_DESCRIPTION, READ | DYNAMIC
// Fan PWM - Coefficient
CHARACTERISTIC, 2B04, READ | WRITE | DYNAMIC
CHARACTERISTIC_USER_DESCRIPTION, READ | DYNAMIC
// Fan PWM - Min Power (Abs)
CHARACTERISTIC, 2B04, READ | WRITE | DYNAMIC
CHARACTERISTIC_USER_DESCRIPTION, READ | DYNAMIC
// Fan PWM - Min Kick-start Power (Abs)
CHARACTERISTIC, 2B04, READ | WRITE | DYNAMIC
CHARACTERISTIC_USER_DESCRIPTION, READ | DYNAMIC
// Fan Kick-Start Time (TimeMilli24)
CHARACTERISTIC, 2B15, READ | WRITE | DYNAMIC
CHARACTERISTIC_USER_DESCRIPTION, READ | DYNAMIC
// Fan Tachometer
CHARACTERISTIC, 03f61fe0-9fe7-4516-98e6-056de551687f, READ | DYNAMIC
CHARACTERISTIC_USER_DESCRIPTION, READ | DYNAMIC
// , , 0x06 uint16, 0 exponent, 0x27A8 RPM, 0x1 BT SIG namespace, 0 unknown desc
CHARACTERISTIC_FORMAT, tachometer-rpm, 06, 0, 27A8, 1, 0000
// Fan PWM & Tachometer Aggregation
CHARACTERISTIC, 79cd747f-91af-49a6-95b2-5b597c683129, READ | NOTIFY | DYNAMIC
CHARACTERISTIC_USER_DESCRIPTION, READ | DYNAMIC
// Service Data Aggregation
CHARACTERISTIC, 75134bec-dd06-49b1-bac2-c15e05fd7199, READ | NOTIFY | DYNAMIC
CHARACTERISTIC_USER_DESCRIPTION, READ | DYNAMIC

/////////////////////////////
// Fan Control Policy Service
// Separate b/c we're interested in including this in the aggregated fan state.
/////////////////////////////

PRIMARY_SERVICE, 260a0845-e62f-48c6-aef9-04f62ff8bffd
// Fan Policy - Cooldown Period (TimeSec16)
CHARACTERISTIC, 2B16, READ | WRITE | DYNAMIC
CHARACTERISTIC_USER_DESCRIPTION, READ | DYNAMIC
// Fan Policy - VOC Passive Max
CHARACTERISTIC, 216aa791-97d0-46ac-8752-60bbc00611e1, READ | WRITE | DYNAMIC
CHARACTERISTIC_USER_DESCRIPTION, READ | DYNAMIC
// Fan Policy - VOC Improvement Min
CHARACTERISTIC, 216aa791-97d0-46ac-8752-60bbc00611e1, READ | WRITE | DYNAMIC
CHARACTERISTIC_USER_DESCRIPTION, READ | DYNAMIC
// Fan Policy - Thermal Limiting Cut-Off
CHARACTERISTIC, 45d2e7d7-40c4-46a6-a160-43eb02d01e27, READ | WRITE | DYNAMIC
CHARACTERISTIC_USER_DESCRIPTION, READ | DYNAMIC
// `compiler_gatt.py` is dumb as a brick: you cannot specify signed integers for exponent
// despite it being a `sint8` field in the spec. Lovely.
// I'm not patching this stupid compiler again, so we got to hand-convert this crap ourselves.
// , , 0x0E sint16, -2 10^exponent, 0x272F Celsius, 0x1 BT SIG namespace, 0x0105 lower
CHARACTERISTIC_FORMAT, org-bluetooth-temperature-lower, 0E, FE, 272F, 1, 0105
// , , 0x0E sint16, -2 10^exponent, 0x272F Celsius, 0x1 BT SIG namespace, 0x0104 upper
CHARACTERISTIC_FORMAT, org-bluetooth-temperature-upper, 0E, FE, 272F, 1, 0104
// , , 0x06 uint16, -2 10^exponent, 0x27AD Percentage, 0x1 BT SIG namespace, 0 unknown desc
CHARACTERISTIC_FORMAT, percentage16_10, 06, FE, 27AD, 1, 0000
CHARACTERISTIC_AGGREGATE_FORMAT, org-bluetooth-temperature-lower, org-bluetooth-temperature-upper, percentage16_10

/////////////////////////////
// NeoPixel Control Service
/////////////////////////////

PRIMARY_SERVICE, f62918ab-33b7-4f47-9fba-8ce9de9fecbb
// total # of components (i.e. octets) in the pixel chain
CHARACTERISTIC, 2AEA, READ | WRITE | DYNAMIC
CHARACTERISTIC_USER_DESCRIPTION, READ | DYNAMIC
// support write w/o response for speed (vastly faster than awaiting a response)
CHARACTERISTIC, 5d91b6ce-7db1-4e06-b8cb-d75e7dd49aae, WRITE | WRITE_WITHOUT_RESPONSE | DYNAMIC
CHARACTERISTIC_USER_DESCRIPTION, READ | DYNAMIC

/////////////////////////////
// Display Service
/////////////////////////////

PRIMARY_SERVICE, 7be8ac4b-7eb4-4e09-b134-91a46b622832
// Display Brightness %
CHARACTERISTIC, 2B04, READ | WRITE | DYNAMIC
CHARACTERISTIC_USER_DESCRIPTION, READ | DYNAMIC
CHARACTERISTIC, 86a25d55-1893-4d01-8ea8-8970f622c243, READ | WRITE | DYNAMIC
CHARACTERISTIC_USER_DESCRIPTION, READ | DYNAMIC

/////////////////////////////
// Photocatalytic Service
/////////////////////////////

PRIMARY_SERVICE, de44dd71-2400-4cd1-a3f3-9fb00c4697d7
// Photocatalytic PWM %
CHARACTERISTIC, 2B04, READ | DYNAMIC
CHARACTERISTIC_USER_DESCRIPTION, READ | DYNAMIC
// Photocatalytic PWM % - Override (not-known -> automatic control)
CHARACTERISTIC, 2B04, READ | WRITE | DYNAMIC
CHARACTERISTIC_USER_DESCRIPTION, READ | DYNAMIC

/////////////////////////////
// Servo Service
/////////////////////////////

PRIMARY_SERVICE, 8959bb3e-3063-4a46-9b9a-69fdbc327f1c
// Vent Servo - Start/End PWM %, use `Percentage16_10` b/c we need more precision than PERC_8
CHARACTERISTIC, 9c327c7f-188f-4345-950f-bd586f13f324, READ | WRITE | DYNAMIC
CHARACTERISTIC_USER_DESCRIPTION, READ | DYNAMIC
CHARACTERISTIC_AGGREGATE_FORMAT, percentage16_10, percentage16_10
// Vent Servo - Actuator %
CHARACTERISTIC, 0543a134-244f-405b-9d43-0351a5336ef7, READ | WRITE | DYNAMIC
CHARACTERISTIC_USER_DESCRIPTION, READ | DYNAMIC

/////////////////////////////
// Configuration Service
/////////////////////////////

PRIMARY_SERVICE, b5078b20-aea3-4c37-a18f-b370c03f02a6
CHARACTERISTIC, f48a18bb-e03c-4583-8006-5b54422e2045, WRITE | DYNAMIC
CHARACTERISTIC_USER_DESCRIPTION, READ | DYNAMIC
CHARACTERISTIC, d4b66bf4-3d8f-4746-b6a2-8a59d2eac3ce, READ | WRITE | DYNAMIC
CHARACTERISTIC_USER_DESCRIPTION, READ | DYNAMIC
CHARACTERISTIC, a84b00c0-7102-4cc6-a4ea-a65050502d3f, WRITE | DYNAMIC
CHARACTERISTIC_USER_DESCRIPTION, READ | DYNAMIC
CHARACTERISTIC, 75bf055c-02be-466f-8c7d-6ebc72078048, WRITE | DYNAMIC
CHARACTERISTIC_USER_DESCRIPTION, READ | DYNAMIC
CHARACTERISTIC, f2810b13-8cd7-4d6f-bb1b-e276db7fadbf, WRITE | DYNAMIC
CHARACTERISTIC_USER_DESCRIPTION, READ | DYNAMIC
// gating threshold (persisted)
CHARACTERISTIC, 216aa791-97d0-46ac-8752-60bbc00611e1, READ | WRITE | DYNAMIC
CHARACTERISTIC_USER_DESCRIPTION, READ | DYNAMIC
// , , 0x06 uint16, 0 exponent, 0x2700 unitless, 0x1 BT SIG namespace, 0 unknown desc
CHARACTERISTIC_FORMAT, sgp40-voc-index, 06, 0, 2700, 1, 0000
VALID_RANGE, READ | DYNAMIC
// gating threshold override (not persisted)
CHARACTERISTIC, 216aa791-97d0-46ac-8752-60bbc00611e1, READ | WRITE | DYNAMIC
CHARACTERISTIC_USER_DESCRIPTION, READ | DYNAMIC
// , , 0x06 uint16, 0 exponent, 0x2700 unitless, 0x1 BT SIG namespace, 0 unknown desc
CHARACTERISTIC_FORMAT, sgp40-voc-index, 06, 0, 2700, 1, 0000
VALID_RANGE, READ | DYNAMIC
CHARACTERISTIC, ee786ac0-7700-47dd-b7de-9958f96303f2, READ | WRITE | DYNAMIC
CHARACTERISTIC_USER_DESCRIPTION, READ | DYNAMIC
CHARACTERISTIC, 5b1dc210-6a51-4cf9-bda7-085604199856, READ | DYNAMIC
CHARACTERISTIC_USER_DESCRIPTION, READ | DYNAMIC
CHARACTERISTIC, 2e9410cb-30fd-4b2c-8c95-934226a9ba29, READ | WRITE | DYNAMIC
CHARACTERISTIC_USER_DESCRIPTION, READ | DYNAMIC
CHARACTERISTIC, 0f6d7c4b-c30c-45b2-b32a-0e5b130429f0, READ | DYNAMIC
CHARACTERISTIC_USER_DESCRIPTION, READ | DYNAMIC
